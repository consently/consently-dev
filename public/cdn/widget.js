(function(){'use strict';const currentScript = document.currentScript || document.querySelector('script[data-consently-id]');const widgetId = currentScript ? currentScript.getAttribute('data-consently-id'):null;if(!widgetId){console.error('[Consently] Error:data-consently-id attribute is required');return;}console.log('[Consently] Initializing widget v3.6 with ID:',widgetId);let isTranslating = false;let languageChangeInProgress = false;let configPollingInterval = null;let lastConfigHash = null;let globalLangClickHandler = null;const defaultConfig ={position:'bottom',layout:'bar',theme:{primaryColor:'#3b82f6',secondaryColor:'#1e40af',backgroundColor:'#ffffff',textColor:'#1f2937',fontFamily:'system-ui,sans-serif',fontSize:14,borderRadius:8,boxShadow:true},title:'We value your privacy',message:'We use cookies to enhance your browsing experience.',acceptButton:{text:'Accept All',backgroundColor:'#3b82f6',textColor:'#ffffff'},rejectButton:{text:'Reject All',backgroundColor:'#ffffff',textColor:'#3b82f6',borderColor:'#3b82f6'},settingsButton:{text:'Cookie Settings',backgroundColor:'#f3f4f6',textColor:'#1f2937'},showRejectButton:true,showSettingsButton:true,autoShow:true,showAfterDelay:0,respectDNT:false,blockContent:false,zIndex:9999};let config = Object.assign({},defaultConfig);let configLoaded = false;let isBannerVisible = false;let sessionId = null;try{sessionId = sessionStorage.getItem('consently_session_id');if(!sessionId){sessionId = 'ses_' + Date.now()+ '_' + Math.random().toString(36).substr(2,9);sessionStorage.setItem('consently_session_id',sessionId);}}catch(e){sessionId = 'ses_' + Date.now()+ '_' + Math.random().toString(36).substr(2,9);}let selectedLanguage = 'en';try{const savedLang = localStorage.getItem('consently_language');if(savedLang){selectedLanguage = savedLang;console.log('[Consently] Loaded saved language:',savedLang);}}catch(e){console.warn('[Consently] localStorage not availablefor language');}let translationCache ={};const CONSENTLY_LOGO_SVG = `<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" style="color:#3b82f6;"> <path d="M12 2L4 6v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V6l-8-4zm0 18.5c-4.05-1.26-7-5.28-7-9.5V7.19l7-3.5 7 3.5V11c0 4.22-2.95 8.24-7 9.5z"/> <path d="M10.5 13.5l-2-2-1.41 1.41L10.5 16.5l6-6-1.41-1.41z"/> </svg>`;asyncfunction translateText(text,targetLang,timeout = 15000){if(targetLang === 'en' || !targetLang || !text)return text;const cacheKey = `${targetLang}:${text}`;if(translationCache[cacheKey]){return translationCache[cacheKey];}const controller = new AbortController();const timeoutId = setTimeout(()=> controller.abort(),timeout);try{const apiBase = config.apiBase || window.location.origin;const response = await fetch(`${apiBase}/api/translate`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({text,target:targetLang,source:'en'}),signal:controller.signal});clearTimeout(timeoutId);if(response.ok){const data = await response.json();const translated = data.translatedText || text;translationCache[cacheKey] = translated;return translated;}else{console.warn('[Consently] Translation API error:',response.status);}}catch(error){clearTimeout(timeoutId);if(error.name !== 'AbortError'){console.error('[Consently] Translation error:',error);}}return text;}asyncfunction translateBatch(texts,targetLang,timeout = 20000){if(targetLang === 'en' || !targetLang || !texts || texts.length === 0){return texts || [];}const textsToTranslate = [];const cachedResults = [];const textIndices = [];texts.forEach((text,index)=>{if(!text){cachedResults[index] = text;return;}const cacheKey = `${targetLang}:${text}`;if(translationCache[cacheKey]){cachedResults[index] = translationCache[cacheKey];}else{textsToTranslate.push(text);textIndices.push(index);}});if(textsToTranslate.length === 0){return cachedResults;}const controller = new AbortController();const timeoutId = setTimeout(()=> controller.abort(),timeout);try{const apiBase = config.apiBase || window.location.origin;const response = await fetch(`${apiBase}/api/translate`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({texts:textsToTranslate,target:targetLang,source:'en'}),signal:controller.signal});clearTimeout(timeoutId);if(response.ok){const data = await response.json();if(data.success && data.translations && Array.isArray(data.translations)){textIndices.forEach((originalIdx,i)=>{const translated = data.translations[i] || textsToTranslate[i] || texts[originalIdx];cachedResults[originalIdx] = translated;const cacheKey = `${targetLang}:${textsToTranslate[i]}`;translationCache[cacheKey] = translated;});return cachedResults;}else{console.warn('[Consently] Unexpected API response format');textIndices.forEach((originalIdx,i)=>{cachedResults[originalIdx] = textsToTranslate[i] || texts[originalIdx];});}}else{console.warn('[Consently] Translation API error:',response.status);textIndices.forEach((originalIdx,i)=>{cachedResults[originalIdx] = textsToTranslate[i] || texts[originalIdx];});}}catch(error){clearTimeout(timeoutId);if(error.name !== 'AbortError'){console.error('[Consently] Translation error:',error);}textIndices.forEach((originalIdx,i)=>{cachedResults[originalIdx] = textsToTranslate[i] || texts[originalIdx];});}return cachedResults;}function languageLabel(code){const map ={en:'English',hi:'‡§π‡§ø‡§Ç‡§¶‡•Ä',bn:'‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ',ta:'‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç',te:'‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å',mr:'‡§Æ‡§∞‡§æ‡§†‡•Ä',gu:'‡™ó‡´Å‡™ú‡™∞‡™æ‡™§‡´Ä',kn:'‡≤ï‡≤®‡≥ç‡≤®‡≤°',ml:'‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç',pa:'‡®™‡©∞‡®ú‡®æ‡®¨‡©Ä',or:'‡¨ì‡¨°‡¨º‡¨ø‡¨Ü',ur:'ÿßÿ±ÿØŸà',as:'‡¶Ö‡¶∏‡¶Æ‡ßÄ‡¶Ø‡¶º‡¶æ',ne:'‡§®‡•á‡§™‡§æ‡§≤‡•Ä',sa:'‡§∏‡§Ç‡§∏‡•ç‡§ï‡•É‡§§‡§Æ‡•ç',ks:'‡§ï‡•â‡§∂‡•Å‡§∞',sd:'‡§∏‡§ø‡§®‡•ç‡§ß‡•Ä',mai:'‡§Æ‡•à‡§•‡§ø‡§≤‡•Ä',doi:'‡§°‡•ã‡§ó‡§∞‡•Ä',kok:'‡§ï‡•ã‡§Ç‡§ï‡§£‡•Ä',mni:'‡¶Æ‡ßà‡¶§‡ßà‡¶≤‡ßã‡¶®‡ßç',brx:'‡§¨‡§°‡§º‡•ã',sat:'·±•·±ü·±±·±õ·±ü·±≤·±§'};return map[code] || '';}function languageFlag(code){const map ={en:'üáÆüá≥',hi:'üáÆüá≥',bn:'üáÆüá≥',ta:'üáÆüá≥',te:'üáÆüá≥',mr:'üáÆüá≥',gu:'üáÆüá≥',kn:'üáÆüá≥',ml:'üáÆüá≥',pa:'üáÆüá≥',or:'üáÆüá≥',ur:'üáÆüá≥',as:'üáÆüá≥',ne:'üáÆüá≥',sa:'üáÆüá≥',ks:'üáÆüá≥',sd:'üáÆüá≥',mai:'üáÆüá≥',doi:'üáÆüá≥',kok:'üáÆüá≥',mni:'üáÆüá≥',brx:'üáÆüá≥',sat:'üáÆüá≥'};return map[code] || 'üåê';}const CookieManager ={set:function(name,value,days){const expires = new Date();expires.setTime(expires.getTime()+(days * 24 * 60 * 60 * 1000));const hostname = window.location.hostname;let domain = '';if(hostname !== 'localhost' && !hostname.startsWith('127.')&& !hostname.startsWith('192.168.')){const parts = hostname.split('.');if(parts.length >= 2){domain = ';domain=' + parts.slice(-2).join('.');}}const isSecure = window.location.protocol === 'https:';const secureFlag = isSecure ? ';Secure':'';document.cookie = name + '=' + encodeURIComponent(JSON.stringify(value))+ ';expires=' + expires.toUTCString()+ ';path=/' + domain + ';SameSite=Lax' + secureFlag;},get:function(name){const nameEQ = name + '=';const ca = document.cookie.split(';');for(let i = 0;i < ca.length;i++){let c = ca[i];while(c.charAt(0)=== ' ')c = c.substring(1,c.length);if(c.indexOf(nameEQ)=== 0){try{return JSON.parse(decodeURIComponent(c.substring(nameEQ.length,c.length)));}catch(e){return null;}}}return null;},delete:function(name){document.cookie = name + '=;expires=Thu,01 Jan 1970 00:00:01 GMT;path=/';}};function debounce(func,wait){let timeout;return function executedFunction(...args){const later =()=>{clearTimeout(timeout);func(...args);};clearTimeout(timeout);timeout = setTimeout(later,wait);};}function hashConfig(configObj){const str = JSON.stringify({theme:configObj.theme,title:configObj.title,message:configObj.message,position:configObj.position,layout:configObj.layout,acceptButton:configObj.acceptButton,rejectButton:configObj.rejectButton,settingsButton:configObj.settingsButton});let hash = 0;for(let i = 0;i < str.length;i++){const char = str.charCodeAt(i);hash =((hash << 5)- hash)+ char;hash = hash & hash;}return hash;}function showWidgetError(message,isCritical = false){const isDevelopment = window.location.hostname === 'localhost' || window.location.hostname.includes('127.0.0.1')|| window.location.hostname.includes('consently.in');if(!isDevelopment && !isCritical){console.warn('[Consently]',message);return;}const existingBanner = document.getElementById('consently-widget-error');if(existingBanner){return;}const errorBanner = document.createElement('div');errorBanner.id = 'consently-widget-error';errorBanner.style.cssText = ` position:fixed;bottom:20px;right:20px;background:${isCritical ? '#fee2e2':'#fef3c7'};border:1px solid ${isCritical ? '#fca5a5':'#fcd34d'};border-radius:8px;padding:12px 16px;max-width:400px;box-shadow:0 4px 6px rgba(0,0,0,0.1);z-index:999999;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;font-size:13px;line-height:1.5;color:${isCritical ? '#991b1b':'#92400e'};`;errorBanner.innerHTML = ` <div style="display:flex;align-items:flex-start;gap:8px;"> <span style="font-size:18px;">${isCritical ? '‚ö†Ô∏è':'‚ÑπÔ∏è'}</span> <div style="flex:1;"> <strong style="display:block;margin-bottom:4px;">Consently Widget ${isCritical ? 'Error':'Notice'}</strong> <div>${message}</div> </div> <button onclick="this.parentElement.parentElement.remove()" style="background:none;border:none;font-size:18px;cursor:pointer;color:inherit;opacity:0.6;padding:0;line-height:1;"> √ó </button> </div> `;document.body.appendChild(errorBanner);if(!isCritical){setTimeout(()=>{if(errorBanner.parentElement){errorBanner.remove();}},10000);}}asyncfunction fetchBannerConfig(isPolling = false){try{const scriptSrc = currentScript.src;let apiBase;if(scriptSrc && scriptSrc.includes('http')){const url = new URL(scriptSrc);apiBase = url.origin;}else{apiBase = window.location.origin;}const cacheBuster = Date.now();const apiUrl = `${apiBase}/api/cookies/widget-public/${widgetId}?_t=${cacheBuster}`;if(!isPolling){console.log('[Consently] Fetching config from:',apiUrl);}let response;try{const controller = new AbortController();const timeoutId = setTimeout(()=> controller.abort(),10000);response = await fetch(apiUrl,{method:'GET',headers:{'Content-Type':'application/json','Accept':'application/json','Cache-Control':'no-cache'},cache:'no-store',signal:controller.signal});clearTimeout(timeoutId);}catch(fetchError){if(fetchError.name === 'AbortError'){if(!isPolling){console.warn('[Consently] Config fetch timeout - will retry');}throw new Error('Request timeout');}if(fetchError.message &&(fetchError.message.includes('ERR_NETWORK_IO_SUSPENDED')|| fetchError.message.includes('Failed to fetch')|| fetchError.message.includes('network')|| fetchError.message.includes('aborted'))){if(!isPolling){console.warn('[Consently] Network request suspended(page may be unloading)- this is normal');}return false;}throw fetchError;}if(!response.ok){if(response.status === 404){const errorData = await response.json().catch(()=>({}));const errorMessage = errorData.error || 'Widget configuration not found';if(!isPolling){console.error(`[Consently] Widget ${widgetId}not found:`,{widgetId:widgetId,status:response.status,error:errorMessage,hint:'This widget may have been deleted. Please check your Consently dashboard and create a new widgetif needed.'});showWidgetError(`Widget ID "${widgetId}" not found. This widget may have been deleted. ` + `Please check your Consently dashboard or contact supportif this persists.`,true);}stopConfigPolling();throw new Error(`Widget not found`);}else if(response.status === 429){if(!isPolling){console.warn('[Consently] Rate limit exceeded. Retrying later...');}throw new Error('Rate limit exceeded');}if(!isPolling){console.error(`[Consently] Config fetch failed:HTTP ${response.status}`);}throw new Error(`HTTP ${response.status}`);}const data = await response.json();if(data &&(data.widgetId || data.bannerId)){const newConfigHash = hashConfig(data);if(isPolling && lastConfigHash !== null && newConfigHash !== lastConfigHash){console.log('[Consently] üîÑ Configuration updated! Refreshing widget...');config = Object.assign({},defaultConfig,data);config.widgetId = widgetId;config.apiEndpoint = '/api/consent/record';config.apiBase = apiBase;lastConfigHash = newConfigHash;const existingConsent = CookieManager.get('consently_consent');const hasValidConsent = existingConsent && existingConsent.timestamp &&((Date.now()- existingConsent.timestamp)/(1000 * 60 * 60 * 24))<(config.consentDuration || 365);const isExplicitPreview = new URLSearchParams(window.location.search).get('preview')=== 'true';if(isBannerVisible &&(!hasValidConsent || isExplicitPreview)){const existingBanner = document.getElementById('consently-banner');const existingBackdrop = document.getElementById('consently-backdrop');if(existingBanner){existingBanner.remove();}if(existingBackdrop){existingBackdrop.remove();}await showConsentBanner();}else{console.log('[Consently] Config updated(banner hidden). Changes will apply on next show.');}return true;}config = Object.assign({},defaultConfig,data);config.widgetId = widgetId;config.apiEndpoint = '/api/consent/record';config.apiBase = apiBase;lastConfigHash = newConfigHash;configLoaded = true;if(!isPolling){console.log('[Consently] ‚úÖ Configuration loaded');}return true;}else{throw new Error('Invalid configuration');}}catch(error){if(!isPolling){console.error('[Consently] Failed to load config:',error);if(error.message && !error.message.includes('Widget not found')&&(error.message.includes('timeout')|| error.message.includes('fetch'))){showWidgetError('Unable to connect to Consently service. Please check your internet connection.',false);}}config.widgetId = widgetId;config.apiEndpoint = '/api/consent/record';config.apiBase = window.location.origin;return false;}}function startConfigPolling(){const isPreviewMode = window.location.hostname.includes('consently.in')|| window.location.hostname.includes('localhost');const existingConsent = CookieManager.get('consently_consent');const hasConsent = existingConsent && existingConsent.timestamp;const pollInterval = isPreviewMode ? 5000:(hasConsent ? 30000:10000);configPollingInterval = setInterval(async()=>{await fetchBannerConfig(true);},pollInterval);console.log(`[Consently] üîÑ Auto-sync enabled - checkingfor updates every ${pollInterval/1000}seconds`);}function stopConfigPolling(){if(configPollingInterval){clearInterval(configPollingInterval);configPollingInterval = null;console.log('[Consently] Auto-sync disabled');}}asyncfunction init(){const isDashboardPage = window.location.pathname.startsWith('/dashboard');const urlParams = new URLSearchParams(window.location.search);const isExplicitPreview = urlParams.get('preview')=== 'true' || urlParams.get('test-widget')=== 'true';if(isDashboardPage && !isExplicitPreview){console.log('[Consently] Dashboard page detected - skipping widget initialization');return;}await fetchBannerConfig();const existingConsent = CookieManager.get('consently_consent');const isPreviewMode =(window.location.hostname.includes('consently.in')|| window.location.hostname.includes('localhost'))&& isExplicitPreview;if(config.respectDNT && navigator.doNotTrack === '1'){console.log('[Consently] DNT enabled');return;}if(existingConsent && existingConsent.timestamp){const consentAge =(Date.now()- existingConsent.timestamp)/(1000 * 60 * 60 * 24);const consentDuration = config.consentDuration || 365;if(consentAge < consentDuration){console.log('[Consently] Valid consent found(age:' + Math.round(consentAge)+ ' days)');if(!existingConsent.status || !existingConsent.categories){console.warn('[Consently] Consent data incomplete,resetting...');CookieManager.delete('consently_consent');}else{applyConsent(existingConsent);startConfigPolling();showConsentButton();if(isPreviewMode && isExplicitPreview){console.log('[Consently] Explicit preview mode - showing bannerfor testing');if(config.autoShow){if(config.showAfterDelay > 0){setTimeout(showConsentBanner,config.showAfterDelay);}else{showConsentBanner();}}}return;}}else{console.log('[Consently] Consent expired(age:' + Math.round(consentAge)+ ' days),showing banner again');CookieManager.delete('consently_consent');}}if(config.autoShow){if(config.showAfterDelay > 0){setTimeout(showConsentBanner,config.showAfterDelay);}else{showConsentBanner();}}startConfigPolling();}asyncfunction showConsentBanner(){const isDashboardPage = window.location.pathname.startsWith('/dashboard');const urlParams = new URLSearchParams(window.location.search);const isExplicitPreview = urlParams.get('preview')=== 'true' || urlParams.get('test-widget')=== 'true';if(isDashboardPage && !isExplicitPreview){console.log('[Consently] Dashboard page - banner suppressed');return;}if(document.getElementById('consently-banner')|| isTranslating){return;}isBannerVisible = true;const position = config.position || 'bottom';const layout = config.layout || 'bar';const needsBackdrop =(position === 'center' || position === 'center-modal' || layout === 'modal');if(needsBackdrop){const backdrop = document.createElement('div');backdrop.id = 'consently-backdrop';backdrop.style.cssText = ` position:fixed;top:0;left:0;right:0;bottom:0;background-color:rgba(0,0,0,0.5);z-index:${(config.zIndex || 9999)- 1};animation:fadeIn 0.3s ease-out;`;document.body.appendChild(backdrop);}const theme = config.theme ||{};const primaryColor = theme.primaryColor || '#3b82f6';const backgroundColor = theme.backgroundColor || '#ffffff';const textColor = theme.textColor || '#1f2937';const fontFamily = theme.fontFamily || 'system-ui,sans-serif';const fontSize = theme.fontSize || 14;const borderRadius = theme.borderRadius || 8;const zIndex = config.zIndex || 9999;console.log('[Consently] Logo URL:',theme.logoUrl);const acceptButton = config.acceptButton ||{};const rejectButton = config.rejectButton ||{};const settingsButton = config.settingsButton ||{};isTranslating = true;const textsToTranslate = [ config.title || 'We value your privacy',config.message || 'We use cookies to enhance your browsing experience.',config.acceptButton?.text || 'Accept All',config.rejectButton?.text || 'Reject All',config.settingsButton?.text || 'Cookie Settings',config.privacyPolicyText || 'Privacy Policy',config.cookiePolicyText || 'Cookie Policy',config.termsText || 'Terms' ];const [title,message,acceptText,rejectText,settingsText,privacyPolicyText,cookiePolicyText,termsText] = await translateBatch(textsToTranslate,selectedLanguage);isTranslating = false;const banner = document.createElement('div');banner.id = 'consently-banner';let positionStyles = '';let maxWidth = '';let layoutStyles = '';switch(position){case 'top':positionStyles = 'top:0;left:0;right:0;';break;case 'bottom':positionStyles = 'bottom:0;left:0;right:0;';break;case 'top-left':positionStyles = 'top:20px;left:20px;';maxWidth = 'max-width:400px;';break;case 'top-right':positionStyles = 'top:20px;right:20px;';maxWidth = 'max-width:400px;';break;case 'bottom-left':positionStyles = 'bottom:20px;left:20px;';maxWidth = 'max-width:400px;';break;case 'bottom-right':positionStyles = 'bottom:20px;right:20px;';maxWidth = 'max-width:400px;';break;case 'center':case 'center-modal':positionStyles = 'top:50%;left:50%;transform:translate(-50%,-50%);';maxWidth = 'max-width:600px;';layoutStyles = 'min-height:200px;';break;default:positionStyles = 'bottom:0;left:0;right:0;';}switch(layout){case 'bar':layoutStyles += 'padding:16px 24px;';break;case 'banner':layoutStyles += 'padding:24px;';break;case 'box':maxWidth = 'max-width:500px;';layoutStyles += 'padding:24px;margin:20px;';break;case 'modal':maxWidth = 'max-width:600px;';layoutStyles += 'padding:32px;box-shadow:0 20px 60px rgba(0,0,0,0.3);';break;default:layoutStyles += 'padding:24px;';}banner.style.cssText = ` position:fixed;${positionStyles}${maxWidth}${layoutStyles}background-color:${backgroundColor};color:${textColor};padding-top:48px;box-shadow:0 4px 20px rgba(0,0,0,0.15);z-index:${zIndex};font-family:${fontFamily};font-size:${fontSize}px;line-height:1.5;border-radius:${borderRadius}px;animation:${position === 'top' ? 'slideDown':position.includes('center')? 'fadeIn':'slideUp'}0.3s ease-out;box-sizing:border-box;word-wrap:break-word;overflow-wrap:break-word;`;banner.innerHTML = ` <style> @keyframes slideUp{from{transform:translateY(100%);opacity:0;}to{transform:translateY(0);opacity:1;}}@keyframes slideDown{from{transform:translateY(-100%);opacity:0;}to{transform:translateY(0);opacity:1;}}@keyframes fadeIn{from{opacity:0;transform:translate(-50%,-50%)scale(0.9);}to{opacity:1;transform:translate(-50%,-50%)scale(1);}}.consently-btn{padding:10px 20px;border-radius:6px;font-weight:500;cursor:pointer;border:none;font-size:14px;transition:all 0.2s;margin:0 8px 8px 0;}.consently-btn:hover{opacity:0.9;transform:translateY(-1px);}.consently-btn-primary{background-color:${acceptButton.backgroundColor || primaryColor};color:${acceptButton.textColor || '#ffffff'};border:2px solid ${acceptButton.borderColor || acceptButton.backgroundColor || primaryColor};}.consently-btn-secondary{background-color:${rejectButton.backgroundColor || 'transparent'};color:${rejectButton.textColor || primaryColor};border:2px solid ${rejectButton.borderColor || primaryColor};}.consently-btn-text{background-color:${settingsButton.backgroundColor || '#f3f4f6'};color:${settingsButton.textColor || textColor};border:2px solid transparent;}.consently-container{max-width:1200px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;gap:24px;flex-wrap:wrap;}.consently-content{flex:1;min-width:300px;}.consently-actions{display:flex;flex-wrap:wrap;align-items:center;gap:8px;}.consently-title{font-size:18px;font-weight:600;margin:0 0 8px 0;display:flex;align-items:center;gap:8px;}.consently-message{margin:0;opacity:0.9;}.consently-lang-selector{position:absolute;top:12px;right:12px;z-index:10;}.consently-lang-btn-banner{display:flex;align-items:center;justify-content:center;padding:8px 12px;border:1px solid #e5e7eb;border-radius:8px;background:white;cursor:pointer;font-size:14px;font-weight:500;transition:all 0.2s;box-shadow:0 1px 2px rgba(0,0,0,0.05);}.consently-lang-btn-banner:hover{background:#f9fafb;transform:translateY(-1px);box-shadow:0 2px 4px rgba(0,0,0,0.1);}.consently-lang-btn-banner:disabled{opacity:0.5;cursor:not-allowed;}.consently-lang-menu-banner{display:none;position:absolute;top:100%;right:0;margin-top:8px;background:white;border:1px solid #e5e7eb;border-radius:10px;box-shadow:0 10px 25px -5px rgba(0,0,0,0.15);z-index:10000;min-width:220px;max-width:320px;max-height:400px;overflow-y:auto;overflow-x:hidden;padding:8px;pointer-events:auto;scrollbar-width:thin;scrollbar-color:#cbd5e1 #f1f5f9;}.consently-lang-menu-banner::-webkit-scrollbar{width:6px;}.consently-lang-menu-banner::-webkit-scrollbar-track{background:#f1f5f9;border-radius:3px;}.consently-lang-menu-banner::-webkit-scrollbar-thumb{background:#cbd5e1;border-radius:3px;}.consently-lang-menu-banner::-webkit-scrollbar-thumb:hover{background:#94a3b8;}.consently-lang-menu-banner .lang-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:6px;}.consently-lang-menu-banner button{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:10px 6px;border:none;background:#f9fafb;border-radius:6px;cursor:pointer;font-size:11px;font-weight:500;color:#6b7280;transition:all 0.15s;pointer-events:auto;user-select:none;position:relative;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}.consently-lang-menu-banner button:hover{background:#f0f9ff;}.consently-lang-menu-banner button.active{background:#dbeafe;font-weight:600;color:${primaryColor};}.consently-lang-menu-banner button.active::before{content:'';position:absolute;top:4px;right:4px;width:6px;height:6px;background:${primaryColor};border-radius:50%;}@media(max-width:768px){.consently-container{flex-direction:column;align-items:flex-start;gap:16px;}.consently-content{min-width:100%;}.consently-actions{width:100%;flex-direction:column;}.consently-btn{width:100%;margin:0 0 8px 0;}.consently-title{font-size:16px;}.consently-message{font-size:13px;}.consently-lang-selector{top:8px;right:8px;}#consently-banner{padding:16px !important;padding-top:48px !important;}}@media(max-width:480px){#consently-banner{padding:12px !important;padding-top:44px !important;font-size:13px !important;}.consently-title{font-size:15px !important;}.consently-message{font-size:12px !important;}.consently-btn{padding:8px 16px !important;font-size:13px !important;}}</style> ${(()=>{const supportedLangs = config.supportedLanguages || ['en'];const validLangs = supportedLangs.filter(code => languageLabel(code));if(validLangs.length <= 1)return '';const langBtnStyle = `display:flex;align-items:center;gap:6px;padding:8px 12px;border:1px solid #e5e7eb;border-radius:8px;background:white;color:${textColor};cursor:pointer;font-size:14px;font-weight:500;transition:all 0.2s;box-shadow:0 1px 2px rgba(0,0,0,0.05);`;return ` <div class="consently-lang-selector"> <button id="consently-lang-btn-banner" class="consently-lang-btn-banner" title="${languageLabel(selectedLanguage)}" style="${langBtnStyle}"> <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"> <circle cx="12" cy="12" r="10"/> <line x1="2" y1="12" x2="22" y2="12"/> <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/> </svg> <span style="font-size:13px;">${languageLabel(selectedLanguage)}</span> <svg width="10" height="10" viewBox="0 0 24 24" fill="currentColor" style="opacity:0.5;"> <path d="M7 10l5 5 5-5z"/> </svg> </button> <div id="consently-lang-menu-banner" class="consently-lang-menu-banner"> <div class="lang-grid"> ${validLangs.map(code => ` <button data-lang="${code}" class="${code === selectedLanguage ? 'active':''}" style="color:${code === selectedLanguage ? primaryColor:'#6b7280'};"> ${code === selectedLanguage ? `<span style="position:absolute;top:4px;right:4px;width:6px;height:6px;background:${primaryColor};border-radius:50%;"></span>`:''}<span style="font-size:11px;font-weight:${code === selectedLanguage ? '600':'500'};white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:100%;">${languageLabel(code)}</span> </button> `).join('')}</div> </div> </div>`;})()}<div class="consently-container"> <div class="consently-content"> ${theme.logoUrl ? `<img src="${theme.logoUrl}" alt="Logo" style="height:32px;width:auto;object-fit:contain;margin-bottom:12px;display:block;" onerror="this.style.display='none'">`:''}<h3 class="consently-title"> ${!theme.logoUrl ? CONSENTLY_LOGO_SVG:''}<span>${title}</span> </h3> <p class="consently-message">${message}</p> ${(()=>{if(!config.categories || config.categories.length === 0)return '';const categoryNames ={necessary:'Necessary',preferences:'Preferences',analytics:'Analytics',marketing:'Marketing',social:'Social'};return ` <div style="margin-top:12px;display:flex;flex-wrap:wrap;gap:8px;"> ${config.categories.filter(cat => cat && typeof cat === 'string').map(cat =>{const name = categoryNames[cat] || cat.charAt(0).toUpperCase()+ cat.slice(1);return `<span style=" display:inline-flex;align-items:center;padding:4px 10px;font-size:11px;font-weight:500;border:1px solid ${primaryColor};color:${primaryColor};background:transparent;border-radius:12px;text-transform:capitalize;">${name}</span>`;}).join('')}</div> `;})()}${(()=>{const links = [];if(config.privacyPolicyUrl){links.push(`<a href="${config.privacyPolicyUrl}" target="_blank" rel="noopener noreferrer" style="color:${theme.primaryColor || '#3b82f6'};text-decoration:underline;">${privacyPolicyText}</a>`);}if(config.cookiePolicyUrl){links.push(`<a href="${config.cookiePolicyUrl}" target="_blank" rel="noopener noreferrer" style="color:${theme.primaryColor || '#3b82f6'};text-decoration:underline;">${cookiePolicyText}</a>`);}if(config.termsUrl){links.push(`<a href="${config.termsUrl}" target="_blank" rel="noopener noreferrer" style="color:${theme.primaryColor || '#3b82f6'};text-decoration:underline;">${termsText}</a>`);}return links.length > 0 ? `<p class="consently-links" style="margin-top:8px;font-size:12px;opacity:0.8;">${links.join(' ‚Ä¢ ')}</p>`:'';})()}</div> <div class="consently-actions"> <button id="consently-accept" class="consently-btn consently-btn-primary"> ${acceptText}</button> ${config.showRejectButton ? ` <button id="consently-reject" class="consently-btn consently-btn-secondary"> ${rejectText}</button> `:''}${config.showSettingsButton ? ` <button id="consently-settings" class="consently-btn consently-btn-text"> ${settingsText}</button> `:''}</div> </div> ${config.showBrandingLink ? ` <div style="margin-top:16px;padding-top:12px;border-top:1px solid rgba(0,0,0,0.1);text-align:center;"> <a href="https://www.consently.in" target="_blank" rel="noopener noreferrer" style="font-size:12px;color:${theme.textColor || '#6b7280'};opacity:0.7;text-decoration:none;transition:opacity 0.15s;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.7'" > Powered by <span style="font-weight:600;">Consently</span> </a> </div> `:''}`;document.body.appendChild(banner);const acceptBtn = document.getElementById('consently-accept');if(acceptBtn){acceptBtn.addEventListener('click',function(){handleConsent('accepted',['necessary','analytics','marketing','preferences']);});}const rejectBtn = document.getElementById('consently-reject');if(rejectBtn){rejectBtn.addEventListener('click',function(){handleConsent('rejected',['necessary']);});}const settingsBtn = document.getElementById('consently-settings');if(settingsBtn){settingsBtn.addEventListener('click',function(e){if(languageChangeInProgress){e.preventDefault();e.stopPropagation();return false;}showSettingsModal();});}const langBtnBanner = document.getElementById('consently-lang-btn-banner');const langMenuBanner = document.getElementById('consently-lang-menu-banner');if(langBtnBanner && langMenuBanner){langBtnBanner.addEventListener('click',function(e){e.stopPropagation();langMenuBanner.style.display = langMenuBanner.style.display === 'none' || !langMenuBanner.style.display ? 'block':'none';});if(globalLangClickHandler){document.removeEventListener('click',globalLangClickHandler);}globalLangClickHandler = function(e){if(!langBtnBanner.contains(e.target)&& !langMenuBanner.contains(e.target)){langMenuBanner.style.display = 'none';}};document.addEventListener('click',globalLangClickHandler);const updateBannerContent = async function(newLang){const existingBanner = document.getElementById('consently-banner');if(!existingBanner)return;console.log('[Consently] Updating banner contentfor language:',newLang);if(globalLangClickHandler){document.removeEventListener('click',globalLangClickHandler);globalLangClickHandler = null;}const theme = config.theme ||{};const primaryColor = theme.primaryColor || '#3b82f6';const loadingOverlay = document.createElement('div');loadingOverlay.id = 'consently-lang-loading';loadingOverlay.style.cssText = ` position:absolute;top:0;left:0;right:0;bottom:0;background:rgba(255,255,255,0.95);display:flex;align-items:center;justify-content:center;z-index:10000;border-radius:inherit;`;loadingOverlay.innerHTML = ` <div style="text-align:center;"> <div style="width:40px;height:40px;border:3px solid #e5e7eb;border-top-color:${primaryColor};border-radius:50%;animation:spin 0.8s linear infinite;margin:0 auto 8px;"></div> <div style="font-size:14px;color:#6b7280;font-weight:500;">Translating...</div> </div> <style> @keyframes spin{to{transform:rotate(360deg);}}</style> `;existingBanner.style.position = 'relative';existingBanner.appendChild(loadingOverlay);await new Promise(resolve => setTimeout(resolve,100));isTranslating = true;const textsToTranslate = [ config.title || 'We value your privacy',config.message || 'We use cookies to enhance your browsing experience.',config.acceptButton?.text || 'Accept All',config.rejectButton?.text || 'Reject All',config.settingsButton?.text || 'Cookie Settings',config.privacyPolicyText || 'Privacy Policy',config.cookiePolicyText || 'Cookie Policy',config.termsText || 'Terms' ];const [title,message,acceptText,rejectText,settingsText,privacyPolicyText,cookiePolicyText,termsText] = await translateBatch(textsToTranslate,newLang);isTranslating = false;const backgroundColor = theme.backgroundColor || '#ffffff';const textColor = theme.textColor || '#1f2937';const acceptButton = config.acceptButton ||{};const rejectButton = config.rejectButton ||{};const settingsButton = config.settingsButton ||{};const supportedLangs = config.supportedLanguages || ['en'];const validLangs = supportedLangs.filter(code => languageLabel(code));const langBtnStyle = `display:flex;align-items:center;gap:6px;padding:8px 12px;border:1px solid #e5e7eb;border-radius:8px;background:white;color:${textColor};cursor:pointer;font-size:14px;font-weight:500;transition:all 0.2s;box-shadow:0 1px 2px rgba(0,0,0,0.05);`;const langSelectorHTML = validLangs.length > 1 ? ` <div class="consently-lang-selector"> <button id="consently-lang-btn-banner" class="consently-lang-btn-banner" title="${languageLabel(newLang)}" style="${langBtnStyle}"> <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"> <circle cx="12" cy="12" r="10"/> <line x1="2" y1="12" x2="22" y2="12"/> <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/> </svg> <span style="font-size:13px;">${languageLabel(newLang)}</span> <svg width="10" height="10" viewBox="0 0 24 24" fill="currentColor" style="opacity:0.5;"> <path d="M7 10l5 5 5-5z"/> </svg> </button> <div id="consently-lang-menu-banner" class="consently-lang-menu-banner"> <div class="lang-grid"> ${validLangs.map(code => ` <button data-lang="${code}" class="${code === newLang ? 'active':''}" style="color:${code === newLang ? primaryColor:'#6b7280'};"> ${code === newLang ? `<span style="position:absolute;top:4px;right:4px;width:6px;height:6px;background:${primaryColor};border-radius:50%;"></span>`:''}<span style="font-size:11px;font-weight:${code === newLang ? '600':'500'};white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:100%;">${languageLabel(code)}</span> </button> `).join('')}</div> </div> </div> `:'';const categoryNames ={necessary:'Necessary',preferences:'Preferences',analytics:'Analytics',marketing:'Marketing',social:'Social'};const categoriesHTML = config.categories && config.categories.length > 0 ? ` <div style="margin-top:12px;display:flex;flex-wrap:wrap;gap:8px;"> ${config.categories.filter(cat => cat && typeof cat === 'string').map(cat =>{const name = categoryNames[cat] || cat.charAt(0).toUpperCase()+ cat.slice(1);return `<span style=" display:inline-flex;align-items:center;padding:4px 10px;font-size:11px;font-weight:500;border:1px solid ${primaryColor};color:${primaryColor};background:transparent;border-radius:12px;text-transform:capitalize;">${name}</span>`;}).join('')}</div> `:'';const links = [];if(config.privacyPolicyUrl){links.push(`<a href="${config.privacyPolicyUrl}" target="_blank" rel="noopener noreferrer" style="color:${theme.primaryColor || '#3b82f6'};text-decoration:underline;">${privacyPolicyText}</a>`);}if(config.cookiePolicyUrl){links.push(`<a href="${config.cookiePolicyUrl}" target="_blank" rel="noopener noreferrer" style="color:${theme.primaryColor || '#3b82f6'};text-decoration:underline;">${cookiePolicyText}</a>`);}if(config.termsUrl){links.push(`<a href="${config.termsUrl}" target="_blank" rel="noopener noreferrer" style="color:${theme.primaryColor || '#3b82f6'};text-decoration:underline;">${termsText}</a>`);}const linksHTML = links.length > 0 ? `<p class="consently-links" style="margin-top:8px;font-size:12px;opacity:0.8;">${links.join(' ‚Ä¢ ')}</p>`:'';existingBanner.innerHTML = ` <style> @keyframes slideUp{from{transform:translateY(100%);opacity:0;}to{transform:translateY(0);opacity:1;}}@keyframes slideDown{from{transform:translateY(-100%);opacity:0;}to{transform:translateY(0);opacity:1;}}@keyframes fadeIn{from{opacity:0;transform:translate(-50%,-50%)scale(0.9);}to{opacity:1;transform:translate(-50%,-50%)scale(1);}}.consently-btn{padding:10px 20px;border-radius:6px;font-weight:500;cursor:pointer;border:none;font-size:14px;transition:all 0.2s;margin:0 8px 8px 0;}.consently-btn:hover{opacity:0.9;transform:translateY(-1px);}.consently-btn-primary{background-color:${acceptButton.backgroundColor || primaryColor};color:${acceptButton.textColor || '#ffffff'};border:2px solid ${acceptButton.borderColor || acceptButton.backgroundColor || primaryColor};}.consently-btn-secondary{background-color:${rejectButton.backgroundColor || 'transparent'};color:${rejectButton.textColor || primaryColor};border:2px solid ${rejectButton.borderColor || primaryColor};}.consently-btn-text{background-color:${settingsButton.backgroundColor || '#f3f4f6'};color:${settingsButton.textColor || textColor};border:2px solid transparent;}.consently-container{max-width:1200px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;gap:24px;flex-wrap:wrap;}.consently-content{flex:1;min-width:300px;}.consently-actions{display:flex;flex-wrap:wrap;align-items:center;gap:8px;}.consently-title{font-size:18px;font-weight:600;margin:0 0 8px 0;display:flex;align-items:center;gap:8px;}.consently-message{margin:0;opacity:0.9;}.consently-lang-selector{position:absolute;top:12px;right:12px;z-index:10;}.consently-lang-btn-banner{display:flex;align-items:center;justify-content:center;padding:8px 12px;border:1px solid #e5e7eb;border-radius:8px;background:white;cursor:pointer;font-size:14px;font-weight:500;transition:all 0.2s;box-shadow:0 1px 2px rgba(0,0,0,0.05);}.consently-lang-btn-banner:hover{background:#f9fafb;transform:translateY(-1px);box-shadow:0 2px 4px rgba(0,0,0,0.1);}.consently-lang-btn-banner:disabled{opacity:0.5;cursor:not-allowed;}.consently-lang-menu-banner{display:none;position:absolute;top:100%;right:0;margin-top:8px;background:white;border:1px solid #e5e7eb;border-radius:10px;box-shadow:0 10px 25px -5px rgba(0,0,0,0.15);z-index:10000;min-width:220px;max-width:320px;max-height:400px;overflow-y:auto;overflow-x:hidden;padding:8px;pointer-events:auto;scrollbar-width:thin;scrollbar-color:#cbd5e1 #f1f5f9;}.consently-lang-menu-banner::-webkit-scrollbar{width:6px;}.consently-lang-menu-banner::-webkit-scrollbar-track{background:#f1f5f9;border-radius:3px;}.consently-lang-menu-banner::-webkit-scrollbar-thumb{background:#cbd5e1;border-radius:3px;}.consently-lang-menu-banner::-webkit-scrollbar-thumb:hover{background:#94a3b8;}.consently-lang-menu-banner .lang-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:6px;}.consently-lang-menu-banner button{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:10px 6px;border:none;background:#f9fafb;border-radius:6px;cursor:pointer;font-size:11px;font-weight:500;color:#6b7280;transition:all 0.15s;pointer-events:auto;user-select:none;position:relative;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}.consently-lang-menu-banner button:hover{background:#f0f9ff;}.consently-lang-menu-banner button.active{background:#dbeafe;font-weight:600;color:${primaryColor};}.consently-lang-menu-banner button.active::before{content:'';position:absolute;top:4px;right:4px;width:6px;height:6px;background:${primaryColor};border-radius:50%;}@media(max-width:768px){.consently-container{flex-direction:column;align-items:flex-start;gap:16px;}.consently-content{min-width:100%;}.consently-actions{width:100%;flex-direction:column;}.consently-btn{width:100%;margin:0 0 8px 0;}.consently-title{font-size:16px;}.consently-message{font-size:13px;}.consently-lang-selector{top:8px;right:8px;}#consently-banner{padding:16px !important;padding-top:48px !important;}}@media(max-width:480px){#consently-banner{padding:12px !important;padding-top:44px !important;font-size:13px !important;}.consently-title{font-size:15px !important;}.consently-message{font-size:12px !important;}.consently-btn{padding:8px 16px !important;font-size:13px !important;}}</style> ${langSelectorHTML}<div class="consently-container"> <div class="consently-content"> ${theme.logoUrl ? `<img src="${theme.logoUrl}" alt="Logo" style="height:32px;width:auto;object-fit:contain;margin-bottom:12px;display:block;" onerror="this.style.display='none'">`:''}<h3 class="consently-title"> ${!theme.logoUrl ? CONSENTLY_LOGO_SVG:''}<span>${title}</span> </h3> <p class="consently-message">${message}</p> ${categoriesHTML}${linksHTML}</div> <div class="consently-actions"> <button id="consently-accept" class="consently-btn consently-btn-primary"> ${acceptText}</button> ${config.showRejectButton ? ` <button id="consently-reject" class="consently-btn consently-btn-secondary"> ${rejectText}</button> `:''}${config.showSettingsButton ? ` <button id="consently-settings" class="consently-btn consently-btn-text"> ${settingsText}</button> `:''}</div> </div> ${config.showBrandingLink ? ` <div style="margin-top:16px;padding-top:12px;border-top:1px solid rgba(0,0,0,0.1);text-align:center;"> <a href="https://www.consently.in" target="_blank" rel="noopener noreferrer" style="font-size:12px;color:${theme.textColor || '#6b7280'};opacity:0.7;text-decoration:none;transition:opacity 0.15s;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.7'" > Powered by <span style="font-weight:600;">Consently</span> </a> </div> `:''}`;const overlay = document.getElementById('consently-lang-loading');if(overlay)overlay.remove();existingBanner.style.display = 'block';existingBanner.style.visibility = 'visible';existingBanner.style.opacity = '1';isBannerVisible = true;const backdrop = document.getElementById('consently-backdrop');const position = config.position || 'bottom';const layout = config.layout || 'bar';const needsBackdrop =(position === 'center' || position === 'center-modal' || layout === 'modal');if(backdrop && needsBackdrop){backdrop.style.display = '';backdrop.style.visibility = 'visible';backdrop.style.opacity = '1';}const acceptBtn = document.getElementById('consently-accept');if(acceptBtn){acceptBtn.addEventListener('click',function(){handleConsent('accepted',['necessary','analytics','marketing','preferences']);});}const rejectBtn = document.getElementById('consently-reject');if(rejectBtn){rejectBtn.addEventListener('click',function(){handleConsent('rejected',['necessary']);});}const settingsBtn = document.getElementById('consently-settings');if(settingsBtn){settingsBtn.addEventListener('click',function(e){if(languageChangeInProgress){e.preventDefault();e.stopPropagation();return false;}showSettingsModal();});}const newLangBtnBanner = document.getElementById('consently-lang-btn-banner');const newLangMenuBanner = document.getElementById('consently-lang-menu-banner');if(newLangBtnBanner && newLangMenuBanner){newLangBtnBanner.addEventListener('click',function(e){e.stopPropagation();newLangMenuBanner.style.display = newLangMenuBanner.style.display === 'none' || !newLangMenuBanner.style.display ? 'block':'none';});if(globalLangClickHandler){document.removeEventListener('click',globalLangClickHandler);}globalLangClickHandler = function(e){if(!newLangBtnBanner.contains(e.target)&& !newLangMenuBanner.contains(e.target)){newLangMenuBanner.style.display = 'none';}};document.addEventListener('click',globalLangClickHandler);newLangMenuBanner.querySelectorAll('button[data-lang]').forEach(function(btn){btn.addEventListener('click',function(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();newLangMenuBanner.style.display = 'none';const lang = this.getAttribute('data-lang');const currentLang = selectedLanguage;if(lang && lang !== currentLang){try{localStorage.setItem('consently_language',lang);}catch(e){console.warn('[Consently] Failed to save language preference');}handleLanguageChange(lang);}return false;},true);});}};const handleLanguageChange = async function(newLang){if(languageChangeInProgress){return;}if(!newLang || newLang === selectedLanguage){return;}const oldLang = selectedLanguage;languageChangeInProgress = true;const currentLangBtn = document.getElementById('consently-lang-btn-banner');if(currentLangBtn)currentLangBtn.disabled = true;try{selectedLanguage = newLang;try{localStorage.setItem('consently_language',newLang);}catch(e){console.warn('[Consently] Failed to save language preference');}const currentLangMenu = document.getElementById('consently-lang-menu-banner');if(currentLangMenu)currentLangMenu.style.display = 'none';await updateBannerContent(newLang);const updatedBanner = document.getElementById('consently-banner');if(updatedBanner){updatedBanner.style.display = 'block';updatedBanner.style.visibility = 'visible';updatedBanner.style.opacity = '1';isBannerVisible = true;}const backdrop = document.getElementById('consently-backdrop');const position = config.position || 'bottom';const layout = config.layout || 'bar';const needsBackdrop =(position === 'center' || position === 'center-modal' || layout === 'modal');if(backdrop && needsBackdrop){backdrop.style.display = 'block';backdrop.style.visibility = 'visible';backdrop.style.opacity = '1';}}catch(error){console.error('[Consently] Language change error:',error);const overlay = document.getElementById('consently-lang-loading');if(overlay)overlay.remove();}finally{languageChangeInProgress = false;const currentLangBtn = document.getElementById('consently-lang-btn-banner');if(currentLangBtn)currentLangBtn.disabled = false;}};langMenuBanner.querySelectorAll('button[data-lang]').forEach(function(btn){btn.addEventListener('click',function(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();langMenuBanner.style.display = 'none';const newLang = this.getAttribute('data-lang');const currentLang = selectedLanguage;if(newLang && newLang !== currentLang){try{localStorage.setItem('consently_language',newLang);}catch(e){console.warn('[Consently] Failed to save language preference');}handleLanguageChange(newLang);}return false;},true);});}}function handleConsent(status,categories){if(!status || !Array.isArray(categories)|| categories.length === 0){console.error('[Consently] Invalid consent data:',{status,categories});return;}const consentId = 'con_' + Date.now()+ '_' + Math.random().toString(36).substr(2,9);const consentData ={status:status,categories:categories,timestamp:Date.now(),widgetId:widgetId,consentId:consentId,domain:window.location.hostname,path:window.location.pathname};const consentDuration = config.consentDuration || 365;CookieManager.set('consently_consent',consentData,consentDuration);const verifyConsent = CookieManager.get('consently_consent');if(verifyConsent && verifyConsent.consentId === consentId){console.log('[Consently] ‚úì Consent saved and verified');}else{console.error('[Consently] ‚ö†Ô∏è Failed to verify consent cookie!');}try{localStorage.removeItem('consently_temp_prefs');}catch(e){}const banner = document.getElementById('consently-banner');if(banner){banner.remove();isBannerVisible = false;}const backdrop = document.getElementById('consently-backdrop');if(backdrop)backdrop.remove();const modal = document.getElementById('consently-modal');if(modal)modal.remove();const loadingOverlay = document.getElementById('consently-loading-overlay');if(loadingOverlay)loadingOverlay.remove();applyConsent(consentData);recordConsent(consentData);setTimeout(()=>{showConsentButton();},1000);if(!configPollingInterval){startConfigPolling();}}function applyConsent(consent){console.log('[Consently] Applying consent:',consent);window.dispatchEvent(new CustomEvent('consentlyUpdate',{detail:consent}));}asyncfunction retryWithBackoff(fn,maxRetries = 3,initialDelay = 1000){let lastError;for(let attempt = 1;attempt <= maxRetries;attempt++){try{return await fn();}catch(error){lastError = error;const isRetryable = error.name === 'AbortError' ||(error.message &&(error.message.includes('timeout')|| error.message.includes('network')|| error.message.includes('Failed to fetch')))||(error.status && error.status >= 500);if(!isRetryable || attempt === maxRetries){throw lastError;}const delay = initialDelay * Math.pow(2,attempt - 1);console.log(`[Consently] Retry attempt ${attempt}/${maxRetries}in ${delay}ms...`);await new Promise(resolve => setTimeout(resolve,delay));}}throw lastError;}asyncfunction recordConsent(consent){try{const apiBase = config.apiBase || window.location.origin;await retryWithBackoff(async()=>{const response = await fetch(`${apiBase}${config.apiEndpoint}`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({widgetId:widgetId,consentId:consent.consentId || 'con_' + Date.now()+ '_' + Math.random().toString(36).substr(2,9),status:consent.status,categories:consent.categories,deviceType:/mobile/i.test(navigator.userAgent)? 'Mobile':'Desktop',userAgent:navigator.userAgent,language:navigator.language || 'en'})});if(!response.ok){const error = new Error(`HTTP ${response.status}`);error.status = response.status;throw error;}return response;},3,1000);console.log('[Consently] Consent recorded');}catch(error){console.error('[Consently] Failed to record consent after retries:',error);}}asyncfunction showSettingsModal(){console.log('[Consently] Opening settings modal...');if(languageChangeInProgress || isTranslating){console.log('[Consently] Operation in progress,please wait');return;}try{const existing = document.getElementById('consently-modal');if(existing)existing.remove();const banner = document.getElementById('consently-banner');if(banner)banner.style.display = 'none';const existingConsent = CookieManager.get('consently_consent');const existingCategories = existingConsent ? existingConsent.categories || ['necessary']:['necessary'];const consentId = existingConsent ?(existingConsent.consentId || 'N/A'):'N/A';const consentDate = existingConsent && existingConsent.timestamp ? new Date(existingConsent.timestamp).toLocaleString():'N/A';console.log('[Consently] Loading preferences:',existingCategories);isTranslating = true;const allTexts = [ 'Preferences','Manage your cookie preferences. Some cookies are necessaryfor the website to function.','Save Preferences','Cancel','Required','Strictly necessary cookies','Essentialfor website functionality','Performance','Help us understand visitor behavior','Targeting','Usedfor targeted advertising','Social Media','Cookies from social media platformsfor sharing content' ];let translations;try{translations = await translateBatch(allTexts,selectedLanguage);}catch(translationError){console.error('[Consently] Translation failed:',translationError);translations = allTexts;}const [modalTitle,modalDescription,saveButtonText,cancelButtonText,requiredLabel] = translations.slice(0,5);const [ necessaryName,necessaryDesc,analyticsName,analyticsDesc,marketingName,marketingDesc,socialName,socialDesc ] = translations.slice(5);isTranslating = false;const theme = config.theme ||{};const modal = document.createElement('div');modal.id = 'consently-modal';modal.style.cssText = ` position:fixed;top:0;left:0;right:0;bottom:0;background-color:rgba(0,0,0,0.5);z-index:9999999;display:flex;align-items:center;justify-content:center;padding:20px;animation:fadeIn 0.2s ease-out;overflow-y:auto;-webkit-overflow-scrolling:touch;`;const categories = [{id:'necessary',name:necessaryName,description:necessaryDesc,required:true},{id:'analytics',name:analyticsName,description:analyticsDesc,required:false},{id:'marketing',name:marketingName,description:marketingDesc,required:false},{id:'social',name:socialName,description:socialDesc,required:false}];let categoriesHTML = '';const availableCategories = config.categories || ['necessary','analytics','marketing','social'];categories.forEach(cat =>{if(availableCategories.includes(cat.id)|| cat.required){const isChecked = cat.required || existingCategories.includes(cat.id);categoriesHTML += ` <div style="padding:16px;border:1px solid #e5e7eb;border-radius:8px;margin-bottom:12px;"> <label style="display:flex;align-items:start;gap:12px;cursor:${cat.required ? 'not-allowed':'pointer'};"> <input type="checkbox" id="cat-${cat.id}" ${cat.required ? 'checked disabled':(isChecked ? 'checked':'')}style="margin-top:4px;width:18px;height:18px;"> <div style="flex:1;"> <div style="font-weight:600;margin-bottom:4px;display:flex;align-items:center;gap:8px;"> ${CONSENTLY_LOGO_SVG}<span>${cat.name}${cat.required ? '<span style="color:#3b82f6;font-size:12px;">(' + requiredLabel + ')</span>':''}</span> </div> <div style="font-size:13px;color:#6b7280;">${cat.description}</div> </div> </label> </div> `;}});modal.innerHTML = ` <style> @keyframes fadeIn{from{opacity:0;}to{opacity:1;}}#consently-lang-btn:hover{background:#2563eb !important;box-shadow:0 4px 8px rgba(59,130,246,0.4)!important;}#consently-lang-btn:disabled{opacity:0.5;cursor:not-allowed;}#consently-lang-menu button:hover{background:#f0f9ff !important;}.consently-modal-content{background-color:white;border-radius:12px;max-width:500px;width:100%;max-height:80vh;overflow-y:auto;padding:24px;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;}@media(max-width:768px){.consently-modal-content{max-width:100%;margin:10px;padding:20px;max-height:90vh;}.consently-modal-content h2{font-size:20px !important;}#consently-modal{padding:10px !important;align-items:flex-end !important;}#consently-lang-btn{font-size:12px !important;padding:6px 10px !important;}}@media(max-width:480px){.consently-modal-content{padding:16px;border-radius:12px 12px 0 0;max-height:95vh;}.consently-modal-content h2{font-size:18px !important;}#consently-modal{padding:0 !important;align-items:flex-end !important;}#consently-lang-btn{font-size:11px !important;padding:5px 8px !important;}#consently-lang-btn svg{width:14px !important;height:14px !important;}}</style> <div class="consently-modal-content"> <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:16px;gap:12px;flex-wrap:wrap;"> <div style="flex:1;min-width:0;"> ${theme.logoUrl ? `<img src="${theme.logoUrl}" alt="Logo" style="height:32px;width:auto;object-fit:contain;margin-bottom:8px;display:block;" onerror="this.style.display='none'">`:''}<h2 style="margin:0;font-size:24px;color:#1f2937;display:flex;align-items:center;gap:8px;word-wrap:break-word;"> ${!theme.logoUrl ? CONSENTLY_LOGO_SVG:''}<span>${modalTitle}</span> </h2> </div> ${(()=>{const supportedLangs = config.supportedLanguages || ['en'];const validLangs = supportedLangs.filter(code => languageLabel(code));if(validLangs.length <= 1)return '';return ` <div style="position:relative;"> <button id="consently-lang-btn" style="display:flex;align-items:center;gap:8px;padding:8px 12px;border:none;border-radius:8px;background:#3b82f6;color:#fff;cursor:pointer;font-weight:600;font-size:14px;transition:all 0.2s;"> <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"> <circle cx="12" cy="12" r="10"/> <line x1="2" y1="12" x2="22" y2="12"/> <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/> </svg> <span id="consently-lang-label">${languageLabel(selectedLanguage)}</span> </button> <div id="consently-lang-menu" style="display:none;position:absolute;right:0;margin-top:8px;background:#fff;border:1px solid #e5e7eb;border-radius:12px;box-shadow:0 10px 25px -5px rgba(0,0,0,.15);overflow:hidden;z-index:10;min-width:180px;max-height:300px;overflow-y:auto;"> ${validLangs.map(code => ` <button data-lang="${code}" style="display:flex;gap:10px;align-items:center;width:100%;text-align:left;padding:12px 16px;border:none;background:${code === selectedLanguage ? '#f0f9ff':'#fff'};cursor:pointer;font-size:14px;font-weight:${code === selectedLanguage ? '600':'500'};color:${code === selectedLanguage ? '#0369a1':'#374151'};transition:all 0.15s;"> <span style="font-size:18px;">${languageFlag(code)}</span> <span>${languageLabel(code)}</span> ${code === selectedLanguage ? '<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="margin-left:auto;"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>':''}</button> `).join('')}</div> </div>`;})()}</div> <p style="margin:0 0 24px 0;color:#6b7280;font-size:14px;"> ${modalDescription}</p> ${categoriesHTML}${existingConsent ? ` <div style="margin-top:16px;padding:12px;background:#f9fafb;border:1px solid #e5e7eb;border-radius:8px;"> <div style="font-size:12px;color:#6b7280;margin-bottom:8px;">üìã Your Consent Record</div> <div style="font-size:11px;color:#374151;margin-bottom:4px;"> <strong>Consent ID:</strong> <span style="font-family:monospace;user-select:all;cursor:text;" title="Click to select">${consentId}</span> </div> <div style="font-size:11px;color:#374151;"> <strong>Given on:</strong> ${consentDate}</div> </div> `:''}<div style="display:flex;gap:12px;margin-top:24px;flex-wrap:wrap;"> <button id="consently-save-settings" class="consently-btn consently-btn-primary" style="flex:1;"> ${saveButtonText}</button> <button id="consently-close-modal" class="consently-btn consently-btn-secondary" style="flex:1;"> ${cancelButtonText}</button> </div> </div> `;document.body.appendChild(modal);modal.offsetHeight;await new Promise(resolve => setTimeout(resolve,50));console.log('[Consently] Modal displayed successfully');const langBtn = document.getElementById('consently-lang-btn');const langMenu = document.getElementById('consently-lang-menu');if(langBtn && langMenu){langBtn.addEventListener('click',function(e){e.stopPropagation();langMenu.style.display = langMenu.style.display === 'none' || !langMenu.style.display ? 'block':'none';});document.addEventListener('click',function(e){if(!langBtn.contains(e.target)&& !langMenu.contains(e.target)){langMenu.style.display = 'none';}});const updateModalContent = async function(translations,newLang){const modalContent = modal.querySelector('.consently-modal-content');if(!modalContent)return;const [modalTitle,modalDescription,saveButtonText,cancelButtonText,requiredLabel] = translations.slice(0,5);const [ necessaryName,necessaryDesc,analyticsName,analyticsDesc,marketingName,marketingDesc,socialName,socialDesc ] = translations.slice(5);const titleElement = modalContent.querySelector('h2 span');if(titleElement)titleElement.textContent = modalTitle;const descElement = modalContent.querySelector('p[style*="margin:0 0 24px"]');if(descElement)descElement.textContent = modalDescription;const langLabel = document.getElementById('consently-lang-label');if(langLabel)langLabel.textContent = languageLabel(newLang);const saveBtn = document.getElementById('consently-save-settings');if(saveBtn)saveBtn.textContent = saveButtonText;const cancelBtn = document.getElementById('consently-close-modal');if(cancelBtn)cancelBtn.textContent = cancelButtonText;const categoryMap ={'necessary':{name:necessaryName,desc:necessaryDesc},'analytics':{name:analyticsName,desc:analyticsDesc},'marketing':{name:marketingName,desc:marketingDesc},'social':{name:socialName,desc:socialDesc}};Object.keys(categoryMap).forEach(catId =>{const checkbox = document.getElementById(`cat-${catId}`);if(checkbox){const label = checkbox.closest('label');if(label){const nameSpan = label.querySelector('span');const descDiv = label.querySelector('div[style*="font-size:13px"]');if(nameSpan){const requiredPart = catId === 'necessary' ? ` <span style="color:#3b82f6;font-size:12px;">(${requiredLabel})</span>`:'';nameSpan.innerHTML = categoryMap[catId].name + requiredPart;}if(descDiv){descDiv.textContent = categoryMap[catId].desc;}}}});const langMenu = document.getElementById('consently-lang-menu');if(langMenu){langMenu.querySelectorAll('button[data-lang]').forEach(btn =>{const btnLang = btn.getAttribute('data-lang');if(btnLang === newLang){btn.style.background = '#f0f9ff';btn.style.fontWeight = '600';btn.style.color = '#0369a1';if(!btn.querySelector('svg:last-child')){btn.innerHTML += '<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="margin-left:auto;"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>';}}else{btn.style.background = '#fff';btn.style.fontWeight = '500';btn.style.color = '#374151';const checkIcon = btn.querySelector('svg:last-child');if(checkIcon)checkIcon.remove();}});}};const handleModalLanguageChange = debounce(async function(newLang){if(languageChangeInProgress)return;languageChangeInProgress = true;langBtn.disabled = true;try{selectedLanguage = newLang;localStorage.setItem('consently_language',newLang);langMenu.style.display = 'none';const modalContent = modal.querySelector('.consently-modal-content');if(modalContent){const existingOverlay = document.getElementById('consently-modal-lang-loading');if(existingOverlay)existingOverlay.remove();const loadingOverlay = document.createElement('div');loadingOverlay.id = 'consently-modal-lang-loading';loadingOverlay.style.cssText = ` position:absolute;top:0;left:0;right:0;bottom:0;background:rgba(255,255,255,0.95);display:flex;align-items:center;justify-content:center;z-index:20;border-radius:inherit;`;loadingOverlay.innerHTML = ` <div style="text-align:center;"> <div style="width:50px;height:50px;border:4px solid #e5e7eb;border-top-color:#3b82f6;border-radius:50%;animation:spin 0.8s linear infinite;margin:0 auto 12px;"></div> <div style="font-size:16px;font-weight:600;color:#1f2937;margin-bottom:4px;">Translating...</div> <div style="font-size:13px;color:#6b7280;">Please wait a moment</div> </div> <style> @keyframes spin{to{transform:rotate(360deg);}}</style> `;modalContent.style.position = 'relative';modalContent.appendChild(loadingOverlay);await new Promise(resolve => setTimeout(resolve,100));}const allTexts = [ 'Preferences','Manage your cookie preferences. Some cookies are necessaryfor the website to function.','Save Preferences','Cancel','Required','Strictly necessary cookies','Essentialfor website functionality','Performance','Help us understand visitor behavior','Targeting','Usedfor targeted advertising','Social Media','Cookies from social media platformsfor sharing content' ];const translations = await translateBatch(allTexts,newLang);await updateModalContent(translations,newLang);const loadingOverlay = document.getElementById('consently-modal-lang-loading');if(loadingOverlay)loadingOverlay.remove();}catch(error){console.error('[Consently] Modal language change error:',error);const loadingOverlay = document.getElementById('consently-modal-lang-loading');if(loadingOverlay)loadingOverlay.remove();}finally{languageChangeInProgress = false;if(langBtn)langBtn.disabled = false;}},300);langMenu.querySelectorAll('button[data-lang]').forEach(function(btn){btn.addEventListener('click',function(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();langMenu.style.display = 'none';const newLang = this.getAttribute('data-lang');if(newLang && newLang !== selectedLanguage){selectedLanguage = newLang;try{localStorage.setItem('consently_language',newLang);}catch(e){console.warn('[Consently] Failed to save language preference');}handleModalLanguageChange(newLang);}return false;},true);});}document.getElementById('consently-save-settings').addEventListener('click',function(){const selectedCategories = ['necessary'];categories.forEach(cat =>{if(!cat.required){const checkbox = document.getElementById('cat-' + cat.id);if(checkbox && checkbox.checked){selectedCategories.push(cat.id);}}});console.log('[Consently] Saving preferences:',selectedCategories);modal.remove();handleConsent('partial',selectedCategories);});document.getElementById('consently-close-modal').addEventListener('click',function(){modal.remove();if(banner)banner.style.display = 'block';});modal.addEventListener('click',function(e){if(e.target === modal){modal.remove();if(banner)banner.style.display = 'block';}});}catch(error){console.error('[Consently] Error in showSettingsModal:',error);isTranslating = false;}}function showConsentButton(){if(document.getElementById('consently-float-btn'))return;const existingConsent = CookieManager.get('consently_consent');if(!existingConsent || !existingConsent.timestamp)return;const consentId = existingConsent.consentId || `con_${existingConsent.timestamp}_${Math.random().toString(36).substr(2,5)}`;const hasDPDPA = typeof window.ConsentlyDPDPA !== 'undefined' || document.querySelector('script[data-dpdpa-widget-id]');const button = document.createElement('div');button.id = 'consently-float-btn';button.innerHTML = ` <style> #consently-float-btn{position:fixed;bottom:20px;left:20px;z-index:9998;cursor:pointer;}.consently-float-trigger{display:flex;align-items:center;justify-content:center;padding:12px;background:white;border:1px solid #e5e7eb;border-radius:50%;box-shadow:0 4px 12px rgba(0,0,0,0.15);transition:all 0.2s;width:48px;height:48px;}.consently-float-trigger:hover{box-shadow:0 6px 16px rgba(0,0,0,0.2);transform:translateY(-2px);}.consently-float-menu{display:none;position:absolute;bottom:100%;left:0;margin-bottom:8px;background:white;border:1px solid #e5e7eb;border-radius:12px;box-shadow:0 8px 20px rgba(0,0,0,0.15);overflow:hidden;min-width:200px;}.consently-float-menu.show{display:block;animation:slideUpFade 0.2s ease-out;}@keyframes slideUpFade{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}}.consently-float-menu button{width:100%;text-align:left;padding:12px 16px;border:none;background:white;cursor:pointer;font-size:14px;color:#374151;transition:background 0.15s;display:flex;align-items:center;gap:8px;}.consently-float-menu button:hover{background:#f3f4f6;}.consently-float-menu button:not(:last-child){border-bottom:1px solid #e5e7eb;}.consently-float-menu button.revoke{color:#dc2626;}.consently-float-menu button.revoke:hover{background:#fef2f2;}.consently-float-menu .divider{height:1px;background:#e5e7eb;margin:4px 0;}.consently-float-menu .section-label{padding:8px 16px;font-size:11px;font-weight:600;color:#6b7280;text-transform:uppercase;letter-spacing:0.5px;background:#f9fafb;}</style> <div class="consently-float-trigger" title="Privacy Preferences"> ${CONSENTLY_LOGO_SVG}</div> <div class="consently-float-menu" id="consently-float-menu"> <div class="section-label">Cookie Preferences</div> <button id="consently-manage-btn"> <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"> <circle cx="12" cy="12" r="3"/> <path d="M12 1v6m0 6v6M5.64 5.64l4.24 4.24m4.24 4.24l4.24 4.24M1 12h6m6 0h6M5.64 18.36l4.24-4.24m4.24-4.24l4.24-4.24"/> </svg> Cookie Preferences </button> <button id="consently-revoke-btn" class="revoke"> <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"> <circle cx="12" cy="12" r="10"/> <line x1="15" y1="9" x2="9" y2="15"/> <line x1="9" y1="9" x2="15" y2="15"/> </svg> Revoke Cookie Consent </button> ${hasDPDPA ? ` <div class="divider"></div> <div class="section-label">DPDPA Preferences</div> <button id="consently-dpdpa-prefs-btn"> <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"> <circle cx="12" cy="12" r="3"/> <path d="M12 1v6m0 6v6M5.64 5.64l4.24 4.24m4.24 4.24l4.24 4.24M1 12h6m6 0h6M5.64 18.36l4.24-4.24m4.24-4.24l4.24-4.24"/> </svg> DPDPA Preferences </button> `:''}<div style="padding:12px 16px;border-top:1px solid #e5e7eb;background:#f9fafb;"> <div style="font-size:11px;color:#6b7280;margin-bottom:4px;">Your Consent ID:</div> <div style="font-family:monospace;font-size:10px;color:#374151;word-break:break-all;user-select:all;cursor:text;" title="Click to select">${consentId}</div> </div> </div> `;document.body.appendChild(button);const trigger = button.querySelector('.consently-float-trigger');const menu = document.getElementById('consently-float-menu');trigger.addEventListener('click',function(e){e.stopPropagation();menu.classList.toggle('show');});document.addEventListener('click',function(e){if(!button.contains(e.target)){menu.classList.remove('show');}});document.getElementById('consently-manage-btn').addEventListener('click',function(){menu.classList.remove('show');showSettingsModal();});document.getElementById('consently-revoke-btn').addEventListener('click',function(){menu.classList.remove('show');revokeConsent();});if(hasDPDPA){const dpdpaBtn = document.getElementById('consently-dpdpa-prefs-btn');if(dpdpaBtn){dpdpaBtn.addEventListener('click',function(){menu.classList.remove('show');if(typeof window.ConsentlyDPDPA !== 'undefined' && window.ConsentlyDPDPA.openPrivacyCentre){window.ConsentlyDPDPA.openPrivacyCentre();}else{const dpdpaWidget = document.getElementById('dpdpa-float-btn');if(dpdpaWidget){dpdpaWidget.querySelector('.dpdpa-float-trigger')?.click();}else{window.dispatchEvent(new CustomEvent('consently-open-dpdpa-prefs'));}}});}}let dpdpaCheckInterval = setInterval(function(){const dpdpaScript = document.querySelector('script[data-dpdpa-widget-id]');const dpdpaExists = dpdpaScript || typeof window.ConsentlyDPDPA !== 'undefined';if(dpdpaExists && !menu.querySelector('#consently-dpdpa-prefs-btn')){const divider = document.createElement('div');divider.className = 'divider';divider.style.cssText = 'height:1px;background:#e5e7eb;margin:4px 0;';const label = document.createElement('div');label.className = 'section-label';label.style.cssText = 'padding:8px 16px;font-size:11px;font-weight:600;color:#6b7280;text-transform:uppercase;letter-spacing:0.5px;background:#f9fafb;';label.textContent = 'DPDPA Preferences';const dpdpaBtn = document.createElement('button');dpdpaBtn.id = 'consently-dpdpa-prefs-btn';dpdpaBtn.style.cssText = 'width:100%;text-align:left;padding:12px 16px;border:none;background:white;cursor:pointer;font-size:14px;color:#374151;transition:background 0.15s;display:flex;align-items:center;gap:8px;';dpdpaBtn.innerHTML = ` <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"> <circle cx="12" cy="12" r="3"/> <path d="M12 1v6m0 6v6M5.64 5.64l4.24 4.24m4.24 4.24l4.24 4.24M1 12h6m6 0h6M5.64 18.36l4.24-4.24m4.24-4.24l4.24-4.24"/> </svg> DPDPA Preferences `;dpdpaBtn.addEventListener('mouseenter',function(){this.style.background = '#f3f4f6';});dpdpaBtn.addEventListener('mouseleave',function(){this.style.background = 'white';});dpdpaBtn.addEventListener('click',function(){menu.classList.remove('show');if(typeof window.ConsentlyDPDPA !== 'undefined' && window.ConsentlyDPDPA.openPrivacyCentre){window.ConsentlyDPDPA.openPrivacyCentre();}else{window.dispatchEvent(new CustomEvent('consently-open-dpdpa-prefs'));}});const consentIdSection = menu.querySelector('div[style*="padding:12px 16px"]');if(consentIdSection){menu.insertBefore(divider,consentIdSection);menu.insertBefore(label,consentIdSection);menu.insertBefore(dpdpaBtn,consentIdSection);}else{menu.appendChild(divider);menu.appendChild(label);menu.appendChild(dpdpaBtn);}clearInterval(dpdpaCheckInterval);}},1000);setTimeout(function(){clearInterval(dpdpaCheckInterval);},10000);}function revokeConsent(){const consentId = 'con_' + Date.now()+ '_' + Math.random().toString(36).substr(2,9);const consentData ={status:'revoked',categories:['necessary'],timestamp:Date.now(),widgetId:widgetId,consentId:consentId};CookieManager.set('consently_consent',consentData,365);recordConsent(consentData);applyConsent(consentData);const floatBtn = document.getElementById('consently-float-btn');if(floatBtn)floatBtn.remove();console.log('[Consently] Consent revoked');if(config.autoShow){setTimeout(()=>{showConsentBanner();},500);}}window.Consently = window.Consently ||{};window.Consently[widgetId] ={show:function(){if(!document.getElementById('consently-banner')){showConsentBanner();}},hide:function(){const banner = document.getElementById('consently-banner');const backdrop = document.getElementById('consently-backdrop');if(banner)banner.remove();if(backdrop)backdrop.remove();isBannerVisible = false;},openSettings:function(){showSettingsModal();},reset:function(){CookieManager.delete('consently_consent');console.log('[Consently] Consent reset');if(config.autoShow){this.show();}},revoke:function(){revokeConsent();},getConsent:function(){return CookieManager.get('consently_consent');},showButton:function(){showConsentButton();},hideButton:function(){const btn = document.getElementById('consently-float-btn');if(btn)btn.remove();},isPreviewMode:function(){return window.location.hostname.includes('consently.in')|| window.location.hostname.includes('localhost');}};if(document.readyState === 'loading'){document.addEventListener('DOMContentLoaded',init);}else{init();}})();